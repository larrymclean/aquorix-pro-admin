// src/api/dashboardSchedule.ts
import { supabase } from "../lib/supabaseClient";

const DASHBOARD_BASE = "http://localhost:3001/api/v1/dashboard";

export type DashboardScheduleResponse = any; // we'll tighten types after it works

export async function getDashboardSchedule(weekStart: string) {
  const { data } = await supabase.auth.getSession();
  const token = data?.session?.access_token;

  if (!token) {
    throw new Error("Not authenticated (no Supabase session token)");
  }

  const res = await fetch(`${DASHBOARD_BASE}/schedule?week_start=${weekStart}`, {
    headers: { Authorization: `Bearer ${token}` },
  });

  const json = await res.json().catch(() => ({}));

  if (!res.ok || json?.ok === false) {
    const msg = json?.message || json?.error || res.statusText || "Schedule fetch failed";
    const err: any = new Error(msg);
    err.status = json?.status || res.status;
    err.details = json;
    throw err;
  }

  return json;
}
